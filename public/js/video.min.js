$(function(){$("video").videoPlayer(),$("a.embed").on("click",function(){return 0===$("a.embed textarea").length&&($("a.embed span").hide(),$(this).append("<textarea><iframe src='http://"+window.location.host+"/embed"+window.location.pathname+"' frameborder='0' width='600' height='450'></iframe></textarea>")),!1})}),function(e){e.fn.videoPlayer=function(){if(/mobile/i.test(navigator.userAgent)){var t=e(".container").css("padding-left").replace("px","");return e("video").attr("controls",!0).attr("width",window.screen.width-2*parseInt(t)).attr("height",(window.screen.width-2*parseInt(t))/1.6),void 0}return e("video").css({width:"100%",height:"auto"}),this.each(function(){e(this)[0].load(),e(this)[0].addEventListener("loadeddata",function(){var t=e(this);t.wrap('<div class="video"></div>');var s=t.parent(".video");e('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="button-holder"><div class="progress-button"> </div></div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-holder"><div class="volume-bar-holder"><div class="volume-bar"><div class="volume-button-holder"><div class="volume-button"> </div></div></div></div></div><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"> <a href="#"> </a></div></div>').appendTo(s);var n,i,r=e(this)[0],d=r.duration,o=r.volume,a=document.title,u=!1,l=!1,c=!1,f=!1,v=0,p=0,o=r.volume;s.bind("selectstart",function(){return!1});var m=s.find(".progress").width(),h=function(){var t=r.buffered;if(s.find("[class^=buffered]").remove(),t.length>0)for(var n=t.length;n--;){$maxBuffer=t.end(n),$minBuffer=t.start(n);var i=100*($minBuffer/d),o=100*(($maxBuffer-$minBuffer)/d);e('<div class="buffered"></div>').css({left:i+"%",width:o+"%"}).appendTo(s.find(".progress"))}};h();var g=function(){var t=Math.round(e(".progress-bar").width()/m*d),n=r.currentTime,i=0,o=Math.floor(t/60),u=Math.round(d/60),l=Math.round(d-60*u);t&&(i=Math.round(t)-60*o,i>59&&(i=Math.round(t)-60*o,60==i&&(o=Math.round(t/60),i=0))),p=n/d*m,10>i&&(i="0"+i),10>l&&(l="0"+l),s.find(".progress-bar").css({width:p+"px"}),r.currentTime>0?s.find(".progress-button").css({left:p-s.find(".progress-button").width()-15+"px"}):s.find(".progress-button").css({left:p-s.find(".progress-button").width()-5+"px"}),s.find(".ctime").html(o+":"+i),s.find(".ttime").html(u+":"+l),r.currentTime>0&&0==r.paused&&0==r.ended&&h(),document.title=c?"Playing "+o+":"+i+" / "+u+":"+l:r.currentTime>0?"Paused "+o+":"+i+" / "+u+":"+l:a};g(),r.addEventListener("timeupdate",g),e(window).resize(function(){r.currentTime>=d&&(r.currentTime=0),m=s.find(".progress").width(),g(),s.find(".progress-bar").css({width:p+"px"}),r.currentTime>0?s.find(".progress-button").css({left:p-s.find(".progress-button").width()-15+"px"}):s.find(".progress-button").css({left:p-s.find(".progress-button").width()-5+"px"}),h()}),s.find(".play-button, .pause-button").on("click",function(){c=r.currentTime>0&&0==r.paused&&0==r.ended?!1:!0,0==c?(e(".play-button, .pause-button").removeClass("playing"),r.pause(),h()):(e(".play-button, .pause-button").addClass("playing"),f=!0,r.play())}),s.find(".progress").bind("mousedown",function(e){u=!0,1==c&&r.pause(),v=e.pageX-s.find(".progress").offset().left,n=v/m*d,r.currentTime=n}),e("body, html").bind("mousemove",function(e){if(1==u){$draggingProgress=!0;var t=0,i=s.find(".progress-button").width();v=e.pageX-s.find(".progress").offset().left,0>v-15?(t=0,r.currentTime=0):v>m?(r.currentTime=d,t=m):(t=v,n=v/m*d,r.currentTime=n),s.find(".progress-bar").css({width:t+"px"}),r.currentTime>0?s.find(".progress-button").css({left:t-i-15+"px"}):s.find(".progress-button").css({left:t-i-5+"px"})}}),r.addEventListener("ended",function(){c=!1,0==$draggingProgress&&e(".play-button, .pause-button").removeClass("playing")}),s.find(".volume").bind("mousedown",function(){o=r.volume,i===void 0&&(i=r.volume),o>0?(r.volume=0,o=0,s.find(".volume-bar").css({height:"0"}),s.find(".volume").addClass("off")):(r.volume=i,o=i,s.find(".volume-bar").css({height:100*i+"%"}),s.find(".volume").removeClass("off"))}),e("body, html").bind("mouseup",function(){u=!1,l=!1,$draggingProgress=!1,1==c&&r.play(),h()}),r.requestFullscreen||r.mozRequestFullScreen||r.webkitRequestFullScreen||e(".fullscreen").hide(),e(".fullscreen").on("click",function(){r.requestFullscreen?r.requestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullScreen&&r.webkitRequestFullScreen()})})})}}(jQuery);
