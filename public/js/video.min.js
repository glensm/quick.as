$(function(){$("video").videoPlayer(),$("a.embed").on("click",function(){if(0===$("a.embed textarea").length){$("a.embed span").hide();var e=$(this).attr("data-width");e>300&&(e="100%"),$(this).append("<textarea><iframe src='http://"+window.location.host+"/embed"+window.location.pathname+"' scrolling='no' frameborder='0' width='"+e+"' allowfullscreen></iframe><script>!function(){function e(){var e=document.getElementsByName('quickcast')\nfor(var n in e){var t=e[n].offsetWidth\ne[n].height=t/1.6+'px'}}e(),window.onresize=e}()</script></textarea>")}return!1})}),function(e){e.fn.videoPlayer=function(){return/mobile/i.test(navigator.userAgent)?(e("video").attr("controls",!0).attr("width",window.screen.width).attr("height",window.screen.width/1.6),void 0):this.each(function(){e(this)[0].load(),e(this)[0].addEventListener("loadeddata",function(){var t=e(this),i=t.attr("data-width"),s=t.attr("data-height"),n=!1;300>=i||300>=s?(n=!0,t.wrap('<div class="video micro"></div>')):t.wrap('<div class="video"></div>'),n===!1?t.css({"min-width":"100%",width:"100%",height:"auto","max-width":i+"px"}):t.css({width:"100%",height:"auto","max-width":i+"px"});var r=t.parent(".video");e('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="button-holder"><div class="progress-button"> </div></div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-holder"><div class="volume-bar-holder"><div class="volume-bar"><div class="volume-button-holder"><div class="volume-button"> </div></div></div></div></div><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"> <a href="#"> </a></div></div>').appendTo(r);var d,o,a=e(this)[0],u=a.duration,l=a.volume,c=document.title,f=!1,v=!1,p=!1,m=!1,h=0,g=0,l=a.volume;r.bind("selectstart",function(){return!1});var b=r.find(".progress").width(),w=function(){var t=a.buffered;if(r.find("[class^=buffered]").remove(),t.length>0)for(var i=t.length;i--;){$maxBuffer=t.end(i),$minBuffer=t.start(i);var s=100*($minBuffer/u),n=100*(($maxBuffer-$minBuffer)/u);e('<div class="buffered"></div>').css({left:s+"%",width:n+"%"}).appendTo(r.find(".progress"))}};w();var y=function(){var t=Math.round(e(".progress-bar").width()/b*u),i=a.currentTime,s=0,n=Math.floor(t/60),d=Math.round(u/60),o=Math.round(u-60*d);t&&(s=Math.round(t)-60*n,s>59&&(s=Math.round(t)-60*n,60==s&&(n=Math.round(t/60),s=0))),g=i/u*b,10>s&&(s="0"+s),10>o&&(o="0"+o),r.find(".progress-bar").css({width:g+"px"}),a.currentTime>0?r.find(".progress-button").css({left:g-r.find(".progress-button").width()-15+"px"}):r.find(".progress-button").css({left:g-r.find(".progress-button").width()-5+"px"}),r.find(".ctime").html(n+":"+s),r.find(".ttime").html(d+":"+o),a.currentTime>0&&0==a.paused&&0==a.ended&&w(),document.title=p?"Playing "+n+":"+s+" / "+d+":"+o:a.currentTime>0?"Paused "+n+":"+s+" / "+d+":"+o:c};y(),a.addEventListener("timeupdate",y),e(window).resize(function(){e(".video").css("width","100%"),a.currentTime>=u&&(a.currentTime=0),b=r.find(".progress").width(),y(),r.find(".progress-bar").css({width:g+"px"}),a.currentTime>0?r.find(".progress-button").css({left:g-r.find(".progress-button").width()-15+"px"}):r.find(".progress-button").css({left:g-r.find(".progress-button").width()-5+"px"}),w()}),n===!1&&(r.find(".player").css("opacity",1),setTimeout(function(){r.find(".player").css("opacity",0)},3e3)),r.find(".play-button, .pause-button").on("click",function(){p=a.currentTime>0&&0==a.paused&&0==a.ended?!1:!0,0==p?(e(".play-button, .pause-button").removeClass("playing"),a.pause(),w()):(e(".play-button, .pause-button").addClass("playing"),m=!0,a.play())}),r.find(".progress").bind("mousedown",function(e){f=!0,1==p&&a.pause(),h=e.pageX-r.find(".progress").offset().left,d=h/b*u,a.currentTime=d}),e("body, html").bind("mousemove",function(e){if(1!=n&&r.hover(function(){r.find(".player").css("opacity",1)},function(){r.find(".player").css("opacity",0)}),1==f){$draggingProgress=!0;var t=0,i=r.find(".progress-button").width();h=e.pageX-r.find(".progress").offset().left,0>h-15?(t=0,a.currentTime=0):h>b?(a.currentTime=u,t=b):(t=h,d=h/b*u,a.currentTime=d),r.find(".progress-bar").css({width:t+"px"}),a.currentTime>0?r.find(".progress-button").css({left:t-i-15+"px"}):r.find(".progress-button").css({left:t-i-5+"px"})}}),a.addEventListener("ended",function(){p=!1,0==$draggingProgress&&e(".play-button, .pause-button").removeClass("playing")}),r.find(".volume").bind("mousedown",function(){l=a.volume,o===void 0&&(o=a.volume),l>0?(a.volume=0,l=0,r.find(".volume-bar").css({height:"0"}),r.find(".volume").addClass("off")):(a.volume=o,l=o,r.find(".volume-bar").css({height:100*o+"%"}),r.find(".volume").removeClass("off"))}),e("body, html").bind("mouseup",function(){f=!1,v=!1,$draggingProgress=!1,1==p&&a.play(),w()}),a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullScreen||e(".fullscreen").hide(),e(".fullscreen").on("click",function(){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()})})})}}(jQuery);
