$(function(){$("video").quickCastPlayer(),$("a.embed").on("click",function(){if(0===$("a.embed textarea").length){$("a.embed span").hide();var e=$(this).attr("data-width");e>300&&(e="100%"),$(this).append("<textarea><iframe src='http://"+window.location.host+"/embed"+window.location.pathname+"' scrolling='no' frameborder='0' width='"+e+"' allowfullscreen></iframe><script>!function(){function e(){var e=document.getElementsByName('quickcast')\nfor(var n in e){var t=e[n].offsetWidth\ne[n].height=t/1.6+'px'}}e(),window.onresize=e}()</script></textarea>")}return!1})}),function(e){e.fn.quickCastPlayer=function(){return/mobile/i.test(navigator.userAgent)?(e("video").attr("controls",!0).attr("width",window.screen.width).attr("height",window.screen.width/1.6),void 0):this.each(function(){/chrome/i.test(navigator.userAgent)&&e(this).find("source[type='video/mp4']").remove(),e(this)[0].load(),e(this)[0].addEventListener("loadeddata",function(){var t=e(this),n=t.attr("data-width"),s=t.attr("data-height"),i=t.attr("data-intro"),a=t.attr("data-outro"),r=!1;300>=n||300>=s?(r=!0,t.wrap('<div class="video micro"></div>')):t.wrap('<div class="video"></div>'),r===!1?(t.css({"min-width":"100%",width:"100%",height:"auto","max-width":n+"px"}),e(".play-button").append("<div><span></span></div>")):t.css({width:"100%",height:"auto","max-width":n+"px"});var o=t.parent(".video");e('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="progress-button"> </div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"> <a href="#"> </a></div></div>').appendTo(o),o.bind("selectstart",function(){return!1}),r===!1&&e(".play-button").append("<div><span></span></div>");var d,u,l=e(this)[0],p=l.duration,c=l.volume,f=document.title,v=!1,m=!1,h=!1,g=!1,b=0,w=0,c=l.volume,y=o.find(".progress").width(),x=function(){var t=l.buffered;if(o.find("[class^=buffered]").remove(),t.length>0)for(var n=t.length;n--;){$maxBuffer=t.end(n),$minBuffer=t.start(n);var s=100*($minBuffer/p),i=100*(($maxBuffer-$minBuffer)/p);e('<div class="buffered"></div>').css({left:s+"%",width:i+"%"}).appendTo(o.find(".progress"))}};x();var T=function(){var t=Math.round(e(".progress-bar").width()/y*p),n=l.currentTime,s=0,a=Math.floor(t/60),d=Math.round(p/60),u=Math.round(p-60*d);t&&(s=Math.round(t)-60*a,s>59&&(s=Math.round(t)-60*a,60==s&&(a=Math.round(t/60),s=0))),w=n/p*y,10>s&&(s="0"+s),10>u&&(u="0"+u),o.find(".progress-bar").css({width:w+"px"});var c=w-o.find(".progress-button").width();0>c&&(c=0),o.find(".progress-button").css({left:c+"px"}),o.find(".ctime").html(a+":"+s),o.find(".ttime").html(d+":"+u),l.currentTime>0&&0==l.paused&&0==l.ended&&x(),document.title=h?"Playing "+a+":"+s+" / "+d+":"+u:l.currentTime>0?"Paused "+a+":"+s+" / "+d+":"+u:f,r===!1&&0>=n&&e(".play-button div span").text(i)};if(T(),l.addEventListener("timeupdate",T),e(window).resize(function(){e(".video").css("width","100%"),l.currentTime>=p&&(l.currentTime=0),y=o.find(".progress").width(),T(),o.find(".progress-bar").css({width:w+"px"});var t=w-o.find(".progress-button").width();0>t&&(t=0),o.find(".progress-button").css({left:t+"px"}),x()}),r===!1)o.find(".player").css("opacity",1),setTimeout(function(){o.find(".player").css("opacity",0)},3e3);else{o.find(".player").css("display","none"),e(".play-button").append("<span></span>");var $=n/1.4;n>s&&($=s/1.4),e(".play-button span").css("margin","-"+parseInt($/2)+"px 0 0 -"+parseInt($/2)+"px"),e(".play-button span").css({width:parseInt($)+"px",height:parseInt($)+"px"})}o.find(".play-button, .pause-button").on("click",function(){h=l.currentTime>0&&0==l.paused&&0==l.ended?!1:!0,0==h?(l.currentTime>0&&0==l.ended&&e(".play-button div").hide(),e(".play-button, .pause-button").removeClass("playing"),l.pause(),x()):(e(".play-button, .pause-button").addClass("playing"),g=!0,l.play())}),o.find(".progress").on("mousedown",function(e){v=!0,1==h&&l.pause(),b=e.pageX-o.find(".progress").offset().left,d=b/y*p,l.currentTime=d}),e("body, html").on("mousemove",function(e){var t=null;if(1!=r&&(o.on("mouseover",function(){clearTimeout(t),o.find(".player").css("opacity",1)}),o.on("mouseout",function(){t=setTimeout(function(){o.find(".player").css("opacity",0)},1e3)})),1==v){$draggingProgress=!0;var n=0;o.find(".progress-button").width(),b=e.pageX-o.find(".progress").offset().left,0>b?(n=0,l.currentTime=0):b>y?(l.currentTime=p,n=y):(n=b,d=b/y*p,l.currentTime=d),o.find(".progress-bar").css({width:n+"px"});var s=w-o.find(".progress-button").width();0>s&&(s=0),o.find(".progress-button").css({left:s+"px"})}}),l.addEventListener("ended",function(){h=!1,r===!1&&(e(".play-button div span").text(a),e(".play-button div").show(),e(".play-button, .pause-button").removeClass("playing"))}),o.find(".volume").on("mousedown",function(){c=l.volume,c>0?(l.volume=0,c=0,o.find(".volume").addClass("off")):(l.volume=u,c=u,o.find(".volume").removeClass("off"))}),e("body, html").on("mouseup",function(){v=!1,m=!1,$draggingProgress=!1,1==h&&l.play(),x()}),l.requestFullscreen||l.mozRequestFullScreen||l.webkitRequestFullScreen||e(".fullscreen").hide(),e(".fullscreen").on("click",function(){l.requestFullscreen?l.requestFullscreen():l.mozRequestFullScreen?l.mozRequestFullScreen():l.webkitRequestFullScreen&&l.webkitRequestFullScreen()})})})}}(jQuery);
