$(function(){$("video").videoPlayer(),$("a.embed").on("click",function(){return 0===$("a.embed textarea").length&&($("a.embed span").hide(),$(this).append("<textarea><iframe src='http://"+document.domain+"/embed' frameborder='0' width='600' height='450'></iframe></textarea>")),!1})}),function(e){e.fn.videoPlayer=function(){if(/mobile/i.test(navigator.userAgent)){var t=e(".container").css("padding-left").replace("px","");return e("video").attr("controls",!0).attr("width",window.screen.width-2*parseInt(t)).attr("height",(window.screen.width-2*parseInt(t))/1.6),void 0}return e("video").css({width:"100%",height:"auto"}),this.each(function(){e(this)[0].load(),e(this)[0].addEventListener("loadeddata",function(){var t=e(this);t.wrap('<div class="video"></div>');var s=t.parent(".video");e('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="button-holder"><div class="progress-button"> </div></div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-holder"><div class="volume-bar-holder"><div class="volume-bar"><div class="volume-button-holder"><div class="volume-button"> </div></div></div></div></div><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"> <a href="#"> </a></div></div>').appendTo(s);var n,r,i=e(this)[0],d=i.duration,o=i.volume,a=document.title,u=!1,l=!1,c=!1,f=!1,v=0,p=0,o=i.volume;s.bind("selectstart",function(){return!1});var m=s.find(".progress").width(),h=function(){var t=i.buffered;if(s.find("[class^=buffered]").remove(),t.length>0)for(var n=t.length;n--;){$maxBuffer=t.end(n),$minBuffer=t.start(n);var r=100*($minBuffer/d),o=100*(($maxBuffer-$minBuffer)/d);e('<div class="buffered"></div>').css({left:r+"%",width:o+"%"}).appendTo(s.find(".progress"))}};h();var g=function(){var t=Math.round(e(".progress-bar").width()/m*d),n=i.currentTime,r=0,o=Math.floor(t/60),u=Math.round(d/60),l=Math.round(d-60*u);t&&(r=Math.round(t)-60*o,r>59&&(r=Math.round(t)-60*o,60==r&&(o=Math.round(t/60),r=0))),p=n/d*m,10>r&&(r="0"+r),10>l&&(l="0"+l),s.find(".progress-bar").css({width:p+"px"}),i.currentTime>0?s.find(".progress-button").css({left:p-s.find(".progress-button").width()-15+"px"}):s.find(".progress-button").css({left:p-s.find(".progress-button").width()-5+"px"}),s.find(".ctime").html(o+":"+r),s.find(".ttime").html(u+":"+l),i.currentTime>0&&0==i.paused&&0==i.ended&&h(),document.title=c?"Playing "+o+":"+r+" / "+u+":"+l:i.currentTime>0?"Paused "+o+":"+r+" / "+u+":"+l:a};g(),i.addEventListener("timeupdate",g),e(window).resize(function(){i.currentTime>=d&&(i.currentTime=0),m=s.find(".progress").width(),g(),s.find(".progress-bar").css({width:p+"px"}),i.currentTime>0?s.find(".progress-button").css({left:p-s.find(".progress-button").width()-15+"px"}):s.find(".progress-button").css({left:p-s.find(".progress-button").width()-5+"px"}),h()}),s.find(".play-button, .pause-button").on("click",function(){c=i.currentTime>0&&0==i.paused&&0==i.ended?!1:!0,0==c?(e(".play-button, .pause-button").removeClass("playing"),i.pause(),h()):(e(".play-button, .pause-button").addClass("playing"),f=!0,i.play())}),s.find(".progress").bind("mousedown",function(e){u=!0,1==c&&i.pause(),v=e.pageX-s.find(".progress").offset().left,n=v/m*d,i.currentTime=n}),e("body, html").bind("mousemove",function(e){if(1==u){$draggingProgress=!0;var t=0,r=s.find(".progress-button").width();v=e.pageX-s.find(".progress").offset().left,0>v-15?(t=0,i.currentTime=0):v>m?(i.currentTime=d,t=m):(t=v,n=v/m*d,i.currentTime=n),s.find(".progress-bar").css({width:t+"px"}),i.currentTime>0?s.find(".progress-button").css({left:t-r-15+"px"}):s.find(".progress-button").css({left:t-r-5+"px"})}}),i.addEventListener("ended",function(){c=!1,0==$draggingProgress&&e(".play-button, .pause-button").removeClass("playing")}),s.find(".volume").bind("mousedown",function(){o=i.volume,r===void 0&&(r=i.volume),o>0?(i.volume=0,o=0,s.find(".volume-bar").css({height:"0"}),s.find(".volume").addClass("off")):(i.volume=r,o=r,s.find(".volume-bar").css({height:100*r+"%"}),s.find(".volume").removeClass("off"))}),e("body, html").bind("mouseup",function(){u=!1,l=!1,$draggingProgress=!1,1==c&&i.play(),h()}),i.requestFullscreen||i.mozRequestFullScreen||i.webkitRequestFullScreen||e(".fullscreen").hide(),e(".fullscreen").on("click",function(){i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullScreen&&i.webkitRequestFullScreen()})})})}}(jQuery);
