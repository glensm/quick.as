$(function(){$("video").quickCastPlayer()}),function(e){e.fn.quickCastPlayer=function(){return/mobile/i.test(navigator.userAgent)?(e("video").css({"min-width":"100%",width:"100%",height:"auto"}),e("video").attr("controls",!0),void 0):this.each(function(){/chrome/i.test(navigator.userAgent)&&e(this).find("source[type='video/mp4']").remove(),e(this)[0].load(),e(this)[0].addEventListener("loadeddata",function(){var t=e(this),s=t.attr("data-width"),n=t.attr("data-height"),i=!1;300>=s||300>=n?(i=!0,t.wrap('<div class="video micro"></div>')):t.wrap('<div class="video"></div>'),i===!1?t.css({"min-width":"100%",width:"100%",height:"auto","max-width":s+"px"}):t.css({width:"100%",height:"auto","max-width":s+"px"});var r=t.parent(".video");e('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="progress-button"> </div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"> <a href="#"> </a></div></div>').appendTo(r),r.bind("selectstart",function(){return!1});var o,a,d=e(this)[0],u=d.duration,l=d.volume,c=document.title,p=!1,f=!1,v=!1,m=!1,h=0,g=0,l=d.volume,b=r.find(".progress").width(),y=function(){var t=d.buffered;if(r.find("[class^=buffered]").remove(),t.length>0)for(var s=t.length;s--;){$maxBuffer=t.end(s),$minBuffer=t.start(s);var n=100*($minBuffer/u),i=100*(($maxBuffer-$minBuffer)/u);e('<div class="buffered"></div>').css({left:n+"%",width:i+"%"}).appendTo(r.find(".progress"))}};y();var w=function(){var t=Math.round(e(".progress-bar").width()/b*u),s=d.currentTime,n=0,i=Math.floor(t/60),o=Math.round(u/60),a=Math.round(u-60*o);t&&(n=Math.round(t)-60*i,n>59&&(n=Math.round(t)-60*i,60==n&&(i=Math.round(t/60),n=0))),g=s/u*b,10>n&&(n="0"+n),10>a&&(a="0"+a),r.find(".progress-bar").css({width:g+"px"});var l=g-r.find(".progress-button").width();0>l&&(l=0),r.find(".progress-button").css({left:l+"px"}),r.find(".ctime").html(i+":"+n),r.find(".ttime").html(o+":"+a),d.currentTime>0&&0==d.paused&&0==d.ended&&y(),document.title=v?"Playing "+i+":"+n+" / "+o+":"+a:d.currentTime>0?"Paused "+i+":"+n+" / "+o+":"+a:c};if(w(),d.addEventListener("timeupdate",w),e(window).resize(function(){e(".video").css("width","100%"),d.currentTime>=u&&(d.currentTime=0),b=r.find(".progress").width(),w(),r.find(".progress-bar").css({width:g+"px"});var t=g-r.find(".progress-button").width();0>t&&(t=0),r.find(".progress-button").css({left:t+"px"}),y()}),i===!1)r.find(".player").css("opacity",1),setTimeout(function(){r.find(".player").css("opacity",0)},3e3);else{r.find(".player").css("display","none"),e(".play-button").append("<span></span>");var x=s/1.4;s>n&&(x=n/1.4),e(".play-button span").css("margin","-"+parseInt(x/2)+"px 0 0 -"+parseInt(x/2)+"px"),e(".play-button span").css({width:parseInt(x)+"px",height:parseInt(x)+"px"})}r.find(".play-button, .pause-button").on("click",function(){v=d.currentTime>0&&0==d.paused&&0==d.ended?!1:!0,0==v?(e(".play-button, .pause-button").removeClass("playing"),d.pause(),y()):(e(".play-button, .pause-button").addClass("playing"),m=!0,d.play())}),r.find(".progress").on("mousedown",function(e){p=!0,1==v&&d.pause(),h=e.pageX-r.find(".progress").offset().left,o=h/b*u,d.currentTime=o}),e("body, html").on("mousemove",function(e){var t=null;if(1!=i&&(r.on("mouseover",function(){clearTimeout(t),r.find(".player").css("opacity",1)}),r.on("mouseout",function(){t=setTimeout(function(){r.find(".player").css("opacity",0)},1e3)})),1==p){$draggingProgress=!0;var s=0;r.find(".progress-button").width(),h=e.pageX-r.find(".progress").offset().left,0>h?(s=0,d.currentTime=0):h>b?(d.currentTime=u,s=b):(s=h,o=h/b*u,d.currentTime=o),r.find(".progress-bar").css({width:s+"px"});var n=g-r.find(".progress-button").width();0>n&&(n=0),r.find(".progress-button").css({left:n+"px"})}}),d.addEventListener("ended",function(){v=!1,0==$draggingProgress&&e(".play-button, .pause-button").removeClass("playing")}),r.find(".volume").on("mousedown",function(){l=d.volume,l>0?(d.volume=0,l=0,r.find(".volume").addClass("off")):(d.volume=a,l=a,r.find(".volume").removeClass("off"))}),e("body, html").on("mouseup",function(){p=!1,f=!1,$draggingProgress=!1,1==v&&d.play(),y()}),d.requestFullscreen||d.mozRequestFullScreen||d.webkitRequestFullScreen||e(".fullscreen").hide(),e(".fullscreen").on("click",function(){d.requestFullscreen?d.requestFullscreen():d.mozRequestFullScreen?d.mozRequestFullScreen():d.webkitRequestFullScreen&&d.webkitRequestFullScreen()})})})}}(jQuery);
